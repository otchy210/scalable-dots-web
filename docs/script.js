(()=>{"use strict";const t=(t,e)=>{if(t)return t;const r=document.querySelector(e);if(!r)throw new Error(`Not found element: ${e}`);return r};let e;const r=()=>e=t(e,".jumbotron");let i;const n=()=>i=t(i,".drop-here");let s;const a=()=>s=t(s,".file-input");let o;const l=()=>o=t(o,".sample-image");let d;const c=()=>d=t(d,".preview");let h;const u=()=>h=t(h,".preview .img-thumbnail");let g;const m=()=>g=t(g,".file-name");let p;const v=()=>p=t(p,".svg-holder");let f;const b=()=>(f=f||Array.from(document.querySelectorAll("input[name=type]"))).filter((t=>t.checked))[0].value.toUpperCase();let $;const w=()=>$=t($,"#size"),y=()=>Number(w().value);let L;const E=()=>L=t(L,"#size-value");let D;const T=()=>D=t(D,"#gap"),X=()=>Number(T().value);let M;const A=()=>M=t(M,"#gap-value"),C=t=>{const e=new FileReader;e.addEventListener("load",(()=>{m().innerHTML=t.name;const r=e.result;u().setAttribute("src",r)})),e.readAsDataURL(t)},N={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};class x{tagName;attrs;children;constructor(t,e,r){this.tagName=t,this.attrs=e,this.children=r}addAttr(t,e){this.attrs[t]="number"==typeof e?String(e):e??t}addChild(t){this.children.push(t)}toTagBody(){return 0===Object.keys(this.attrs).length?this.tagName:`${this.tagName} ${Object.entries(this.attrs).map((([t,e])=>{return t===e?t:`${t}="${r=e,r.replace(/[&<>'"]/g,(t=>N[t]))}"`;var r})).join(" ")}`}innerToMinifiedXml(t){if(t>=16)throw new Error("XmlNode depth must be less than 16.");if(0===this.children.length)return`<${this.toTagBody()}/>`;{const e=[];return e.push(`<${this.toTagBody()}>`),this.children.forEach((r=>e.push(r.innerToMinifiedXml(t+1)))),e.push(`</${this.tagName}>`),e.join("")}}toMinifiedXml(){return this.innerToMinifiedXml(0)}innerToPrettyXml(t,e){if(e>=16)throw new Error("XmlNode depth must be less than 16.");const r=t.repeat(e);if(0===this.children.length)return`${r}<${this.toTagBody()}/>\n`;{const i=[];return i.push(`${r}<${this.toTagBody()}>\n`),this.children.forEach((r=>i.push(r.innerToPrettyXml(t,e+1)))),i.push(`${r}</${this.tagName}>\n`),i.join("")}}toPrettyXml(t="  "){return this.innerToPrettyXml(t,0).trim()}static builder(t){return new z(t)}}class z{tagName;attrs;children;constructor(t){this.tagName=t,this.attrs={},this.children=[]}attr(t,e){return this.attrs[t]="number"==typeof e?String(e):e??t,this}child(t){return t&&this.children.push(t),this}build(){return new x(this.tagName,this.attrs,this.children)}}class P{root;constructor({width:t,height:e}){this.root=x.builder("svg").attr("viewBox",`0 0 ${t} ${e}`).attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1").build()}addDot(t,e){switch(t){case"SQUARE":this.addSquareDot(e);break;case"CIRCLE":this.addCircleDot(e);break;case"RHOMBUS":this.addRhombusDot(e)}}addSquareDot({x:t,y:e,size:r,fill:i}){const n=x.builder("path").attr("d",`m${t} ${e}h${r}v${r}h-${r}z`).attr("fill",i).build();this.root.addChild(n)}addCircleDot({x:t,y:e,size:r,fill:i}){const n=r/2,s=t+n,a=e+n,o=x.builder("circle").attr("cx",s).attr("cy",a).attr("r",n).attr("fill",i).build();this.root.addChild(o)}addRhombusDot({x:t,y:e,size:r,fill:i}){const n=r/2,s=x.builder("path").attr("d",`m${t} ${e+n}l${n} -${n}l${n} ${n}l-${n} ${n}z`).attr("fill",i).build();this.root.addChild(s)}toMinifiedXml(){return this.root.toMinifiedXml()}toPrettyXml(t="  "){return this.root.toPrettyXml(t)}}const S=t=>(t%256).toString(16).padStart(2,"0"),B=t=>{const e=t%256;return 0===e?".0":255===e?"1":(e/256).toFixed(3).slice(1).replace(/0+$/,"")};class H{svgDocument;constructor({imageData:t,type:e,size:r,gap:i}){const n=(r+i)*t.width-i,s=(r+i)*t.height-i;this.svgDocument=new P({width:n,height:s});for(let n=0;n<t.height;n++)for(let s=0;s<t.width;s++){const a=4*(n*t.width+s),[o,l,d,c]=t.data.slice(a,a+4);if(0===c)continue;const h={x:s*(r+i),y:n*(r+i),size:r,fill:255===c?`#${S(o)}${S(l)}${S(d)}`:`rgba(${o},${l},${d},${B(c)})`};this.svgDocument.addDot(e,h)}}toMinifiedXml(){return this.svgDocument.toMinifiedXml()}toPrettyXml(t="  "){return this.svgDocument.toPrettyXml(t)}}let R;const k=()=>{const t=u(),{naturalWidth:e,naturalHeight:r}=t;if(!e||!r)throw new Error("Can't get image size");const i=document.createElement("canvas");i.width=e,i.height=r;const n=i.getContext("2d");if(!n)throw new Error("Can't get canvas context");return n.drawImage(t,0,0),R=n.getImageData(0,0,e,r)},j=()=>{const t=(e={imageData:R||k(),type:b(),size:y(),gap:X()},new H(e)).toMinifiedXml();var e;v().innerHTML=t},q={rule:t=>"jumbotron-bg"===t.getAttribute("name"),handle:t=>{const e=r();e.classList.remove("bg-svg","bg-png"),e.classList.add(`bg-${t.getAttribute("value")}`)}},I=()=>{const t=c(),e=t.children[0].getBoundingClientRect().height;t.style.height=`${e}px`},O=()=>{const t=v(),e=t.getBoundingClientRect();t.style.height=`${e.width}px`},U={rule:t=>t.classList.contains("save-svg"),handle:()=>{const t=m().innerHTML,e=`${t.slice(0,t.lastIndexOf("."))}-${b().charAt(0).toLowerCase()}_${y()}_${X()}.svg`,r=v().innerHTML,i=`data:image/png;base64,${btoa(r)}`,n=document.createElement("a");n.setAttribute("download",e),n.setAttribute("href",i),n.click()}},F=[q,{rule:t=>"preview-bg"===t.getAttribute("name"),handle:t=>{[u(),v()].forEach((e=>{e.classList.remove("bg-black","bg-gray","bg-white"),e.classList.add(`bg-${t.getAttribute("value")}`)}))}},{rule:t=>"type"===t.getAttribute("name"),handle:()=>{j()}},{rule:t=>t.classList.contains("drop-here"),handle:()=>{a().click()}},U];document.addEventListener("click",(t=>{const e=t.target;e&&F.filter((t=>t.rule(e))).forEach((t=>{t.handle(e)}))})),window.addEventListener("resize",(()=>{O(),c().style.height&&I()})),window.addEventListener("load",(()=>{u().addEventListener("load",(()=>{k(),j(),O(),I()})),(()=>{const t=a();t.addEventListener("change",(()=>{if(!t.files||!t.files[0])return;const e=t.files[0];C(e)}))})(),(()=>{const t=n();t.addEventListener("dragenter",(e=>{e.preventDefault(),e.stopPropagation(),t.classList.add("dragging")})),t.addEventListener("dragover",(t=>{t.preventDefault(),t.stopPropagation()})),t.addEventListener("dragleave",(e=>{e.preventDefault(),e.stopPropagation(),t.classList.remove("dragging")})),t.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation(),t.classList.remove("dragging");const r=e.dataTransfer?.files[0];r&&C(r)}))})(),(()=>{const t=l();t.addEventListener("change",(()=>{const e=t.value;if(!e)return;m().innerHTML=e;const r=`/sample-images/${e}`;u().setAttribute("src",r)}))})(),(()=>{const t=w(),e=E();t.addEventListener("input",(()=>{e.innerHTML=t.value,j()}));const r=T(),i=A();r.addEventListener("input",(()=>{i.innerHTML=r.value,j()}))})()}))})();